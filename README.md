# Gurenko AI Mini App Bot (MVP)

✅ Подписка-гейт (проверка подписки на канал)
✅ Мини-приложение внутри Telegram (WebApp)
✅ Генерация изображений через Freepik Mystic (ботом)
✅ Автозагрузка новых промтов из канала
✅ Оплата Telegram Stars (XTR) → начисление “генераций”
✅ Личный профиль (баланс, история, траты)
✅ Реферальная ссылка + кнопка «поделиться»
✅ Кнопка «в статус/Stories» в Mini App (shareToStory)

## 1) Что нужно заранее

1. Создать бота через **@BotFather** → получить `BOT_TOKEN`
2. **Добавить бота админом** в канал **@gurenko_kristina_ai**
   - иначе проверка подписки работать не будет
3. В Freepik developers dashboard создать `FREEPIK_API_KEY`
4. (Опционально) Узнать username бота и записать `BOT_USERNAME` (нужно для реф-ссылок)

> Freepik API использует API key в заголовке `x-freepik-api-key` и работает только server-to-server (ключ нельзя светить в браузере).

## 2) Запуск локально

```bash
npm i
cp .env.example .env
npm start
```

Мини-приложение будет доступно:

- http://localhost:3000/miniapp

## 3) Деплой

Можно деплоить на Render / Railway / VPS.

**Важно для Mini App:** домен нужно привязать к боту через BotFather (настройка WebApp domain).

### Важные переменные .env

Обязательные:

- `BOT_TOKEN` — токен бота
- `FREEPIK_API_KEY` — ключ Freepik Mystic API
- `WEBAPP_URL` — публичный URL Mini App (например https://your-app.com/miniapp)

Желательно:

- `BOT_USERNAME` — @username твоего бота (нужно для реферальной ссылки / поделиться)
- `START_BONUS_CREDITS` — сколько генераций давать новым пользователям (по умолчанию 2)
- `REFERRAL_BONUS_CREDITS` — бонус за друга (по умолчанию 1)
- `ENABLE_CHANNEL_GATE=0` — отключить проверку подписки на уровне API (по умолчанию включено)

## 3.1) Оплата Stars

В коде уже добавлены готовые пакеты (Stars → генерации).
Можно поменять в `src/bot.js` и `server.js` в массиве `PACKS`.

Используется валюта `XTR` (Telegram Stars). Для цифровых товаров `provider_token` можно оставлять пустым.

## 3.2) Личный профиль

Команда/кнопка **Профиль** показывает:
• баланс генераций
• потраченные Stars
• последнюю картинку
• реферальную ссылку

## 4) Как добавлять новые промты

Пиши пост в канале в формате:

```
Название промта (коротко)
сам промт целиком одной/несколькими строками
```

Бот подхватит пост и добавит в библиотеку.
